<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Screen Saver</title>

  <!-- Custom favicon -->
  <link rel="icon" type="image/png" href="https://api.agilixbuzz.com/dlap.ashx?cmd=getresource&entityid=//anths&path=public/shadow/app/buzz/Echo_White_E_Black_72x72.png" />

  <style>
    html,body{
      height:100%;
      margin:0;
      background:#000;
      color:#fff;
      font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      -webkit-user-select:none;
      user-select:none;
    }
    #hint{
      position:fixed;
      left:12px;
      bottom:12px;
      color:#888;
      font-size:12px;
      opacity:0.9;
    }
  </style>
</head>
<body>
  <div id="hint">Type your secret code...</div>

  <script>
  (function(){
    // ---------- CONFIG ----------
    // Code 1
    const SECRET_1 = "67"; // first secret combo
    const NEW_TAB_1 = "https://example.com"; // site to load in about:blank tab
    const REPLACE_1 = "https://wwhs.echo-ntn.org/"; // site to show in this tab

    // Code 2
    const SECRET_2 = "420"; // second secret combo
    const NEW_TAB_2 = "https://openai.com"; // site to load in about:blank tab
    const REPLACE_2 = "https://wwhs.echo-ntn.org/"; // site to show in this tab

    const MAX_BUFFER = 20;
    // ----------------------------

    const buffer = [];
    const sequences = [
      { code: SECRET_1.split(""), newTab: NEW_TAB_1, replace: REPLACE_1 },
      { code: SECRET_2.split(""), newTab: NEW_TAB_2, replace: REPLACE_2 },
    ];

    function normKey(k){
      return k && k.length === 1 ? k.toLowerCase() : k.toLowerCase();
    }

    function checkMatch(seq){
      if(buffer.length < seq.length) return false;
      for(let i=0;i<seq.length;i++){
        if(buffer[buffer.length - seq.length + i] !== seq[i]) return false;
      }
      return true;
    }

    // Opens a cloaked about:blank tab with an iframe to the target
    function openCloakedNewTab(target){
      try {
        const newTab = window.open('about:blank', '_blank');
        if(!newTab){
          // Fallback if popup blocked
          window.open(target, '_blank');
          return;
        }
        newTab.document.write(`<!doctype html>
          <html>
            <head><meta charset="utf-8">
              <meta name="viewport" content="width=device-width,initial-scale=1" />
              <title></title>
              <style>
                html,body{margin:0;height:100%;overflow:hidden;background:#000}
                iframe{border:0;width:100%;height:100%}
              </style>
            </head>
            <body>
              <iframe src="${target}" allowfullscreen sandbox="allow-forms allow-scripts allow-same-origin allow-popups"></iframe>
            </body>
          </html>`);
        newTab.document.close();
        newTab.focus();
      } catch (e) {
        // If writing fails, open directly
        window.open(target, '_blank');
      }
    }

    // Replace this tab with the specified URL
    function replaceThisTab(target){
      try {
        location.replace(target);
      } catch {
        location.assign(target);
      }
    }

    // Trigger when any code matches
    function triggerAction(code){
      openCloakedNewTab(code.newTab);
      setTimeout(() => replaceThisTab(code.replace), 50);
    }

    // Listen for typing
    window.addEventListener("keydown", function(e){
      const k = normKey(e.key);
      if(!k) return;
      buffer.push(k);
      if(buffer.length > MAX_BUFFER) buffer.shift();

      for(const code of sequences){
        if(checkMatch(code.code)){
          triggerAction(code);
          buffer.length = 0;
          break;
        }
      }
    }, {passive:true});

    // Hide hint after a few seconds
    setTimeout(()=>{ const h=document.getElementById('hint'); if(h) h.style.display='none'; }, 3500);
  })();
  </script>
</body>
</html>
