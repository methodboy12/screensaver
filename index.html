<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Clever</title>
<link rel="icon" type="image/png" href="/favicon.png" />
<style>
  html,body{
    margin:0;
    height:100%;
    background:#000;
    overflow:hidden;
    font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;
    color:#fff;
  }
  #hint{
    position:fixed;
    bottom:12px;
    left:12px;
    color:#888;
    font-size:12px;
    z-index:3;
  }
  #linkIndicator{
    position:fixed;
    bottom:4px;
    right:8px;
    font-size:10px;
    color:#444;
    z-index:3;
  }
  #screensaverCanvas{
    position:fixed;
    top:0;left:0;
    width:100vw;height:100vh;
    z-index:1;
    opacity:0;
    transition:opacity 2.5s ease;
    pointer-events:auto;
    display:block;
  }
  #screensaverCanvas.active{
    opacity:1;
  }

  /* hidden container for x-frame-anywhere iframes */
  #xframeContainer{
    display:none; /* keeps them out of view but present in DOM */
  }
</style>

<!-- x-frame-anywhere loader (module) -->
<script type="module" src="https://cdn.jsdelivr.net/gh/x64bitMango/x-frame-anywhere/x-frame-anywhere.js" defer></script>

<script>
  function updateFavicon(url){
    const link = document.querySelector("link[rel='icon']") || document.createElement('link');
    link.rel = 'icon';
    link.type = 'image/png';
    link.href = url;
    document.head.appendChild(link);
  }
</script>
</head>
<body>

<div id="hint">Saving your screen from falling asleep!</div>
<div id="linkIndicator"></div>
<canvas id="screensaverCanvas"></canvas>

<!-- Hidden x-frame-anywhere iframes for each secret link -->
<div id="xframeContainer" aria-hidden="true">
  <!-- replaced example.com with secret links -->
  <iframe is="x-frame-anywhere" src="https://gn-math.dev/"></iframe>
  <iframe is="x-frame-anywhere" src="https://novamath.net/"></iframe>
  <iframe is="x-frame-anywhere" src="https://kbhgames.com/"></iframe>
  <iframe is="x-frame-anywhere" src="https://pokemonshowdown.com/"></iframe>
  <iframe is="x-frame-anywhere" src="https://open.spotify.com/"></iframe>
  <iframe is="x-frame-anywhere" src="https://neal.fun/"></iframe>
</div>

<script>
(function(){
  const REPLACEMENTS = [
    { url:"https://www.clever.com", title:"Clever" },
    { url:"https://wwhs.echo-ntn.org", title:"Buzz" },
    { url:"about:blank", title:"about:blank" }
  ];

  const SECRETS = ["g1","g2","g3","saver","poke","s1","n1"]; // saver toggles screensaver
  const maps = { g1:"https://gn-math.dev/", g2:"https://novamath.net/", g3:"https://kbhgames.com/", poke:"https://pokemonshowdown.com/", s1:"https://open.spotify.com/", n1:"https://neal.fun/" };

  const canvas = document.getElementById('screensaverCanvas');
  const ctx = canvas.getContext('2d');
  const indicator = document.getElementById('linkIndicator');
  const hint = document.getElementById('hint');

  let index = parseInt(localStorage.getItem('linkChoice')||'0',10);
  let REPLACE_TARGET = REPLACEMENTS[index].url;
  indicator.textContent = REPLACE_TARGET;
  document.title = REPLACEMENTS[index].title;

  function resize(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener('resize', resize);

  const MAX_BUFFER = 60;
  const buffer = [];

  let saverOn = false;
  const modes = ['galaxy','rainbow','pulse'];
  let mode = 0; // index into modes

  // galaxy particles
  let galaxyStars = [];
  let mouseX = 0, mouseY = 0, mouseDown = false;
  function initGalaxy(){
    galaxyStars = Array.from({length:350}, ()=>({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height,
      r: Math.random()*1.8 + 0.6,
      dx: (Math.random()-0.5)*0.6,
      dy: (Math.random()-0.5)*0.6,
      hue: Math.random()*360
    }));
  }

  // white twinkling stars overlay
  let twinkleStars = [];
  function initTwinkles(){
    twinkleStars = Array.from({length:220}, ()=>({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height,
      r: Math.random()*1.2 + 0.3,
      t: Math.random()*Math.PI*2,
      speed: 0.02 + Math.random()*0.04
    }));
  }

  function drawGalaxy(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const grad = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
    grad.addColorStop(0, 'rgba(6,3,37,0.85)');
    grad.addColorStop(1, 'rgba(1,6,20,0.85)');
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    const repelRadius = Math.min(canvas.width, canvas.height) * 0.18; 
    const repelStrength = mouseDown ? 0.6 : 0.25; 

    for(const s of galaxyStars){
      s.x += s.dx * (1 + s.r*0.2);
      s.y += s.dy * (1 + s.r*0.2);
      s.hue = (s.hue + 0.005) % 360;

      const dx = s.x - mouseX;
      const dy = s.y - mouseY;
      const dist = Math.sqrt(dx*dx + dy*dy) + 0.0001;

      if(dist < repelRadius){
        const force = (repelRadius - dist) / repelRadius * repelStrength;
        s.dx += (dx / dist) * force;
        s.dy += (dy / dist) * force;
      }

      s.dx *= 0.994;
      s.dy *= 0.994;

      if(s.x < -10) s.x = canvas.width + 10;
      if(s.x > canvas.width + 10) s.x = -10;
      if(s.y < -10) s.y = canvas.height + 10;
      if(s.y > canvas.height + 10) s.y = -10;

      const g = ctx.createRadialGradient(s.x, s.y, 0, s.x, s.y, s.r*6);
      g.addColorStop(0, `hsla(${s.hue},90%,75%,1)`);
      g.addColorStop(0.2, `hsla(${s.hue},80%,60%,0.7)`);
      g.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r*6, 0, Math.PI*2);
      ctx.fill();

      ctx.beginPath();
      ctx.fillStyle = `hsla(${s.hue},90%,80%,0.95)`;
      ctx.arc(s.x, s.y, Math.max(0.6, s.r/2), 0, Math.PI*2);
      ctx.fill();
    }
  }

  function drawRainbow(){
    const g = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
    const t = (Date.now()/200) % 360;
    g.addColorStop(0, `hsl(${t},100%,50%)`);
    g.addColorStop(0.5, `hsl(${(t+120)%360},100%,50%)`);
    g.addColorStop(1, `hsl(${(t+240)%360},100%,50%)`);
    ctx.fillStyle = g;
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }

  function drawPulse(){
    const t = Date.now()/400;
    const r = Math.sin(t)*0.5 + 0.5;
    ctx.fillStyle = `rgba(${Math.floor(r*200)},${Math.floor(r*60)},${Math.floor(200 + r*55)},1)`;
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }

  function drawTwinkles(){
    for(const s of twinkleStars){
      s.t += s.speed;
      const alpha = 0.3 + Math.abs(Math.sin(s.t))*0.7;
      ctx.beginPath();
      ctx.fillStyle = `rgba(255,255,255,${alpha})`;
      ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
      ctx.fill();
    }
  }

  canvas.addEventListener('mousemove', e=>{
    const rect = canvas.getBoundingClientRect();
    mouseX = e.clientX - rect.left;
    mouseY = e.clientY - rect.top;
  });
  canvas.addEventListener('mousedown', e=>{
    mouseDown = true;
    const impulseRadius = Math.min(canvas.width, canvas.height) * 0.12;
    const impulseStrength = 2.2;
    for(const s of galaxyStars){
      const dx = s.x - mouseX, dy = s.y - mouseY; const d = Math.sqrt(dx*dx + dy*dy) + 0.0001;
      if(d < impulseRadius){
        const f = (impulseRadius - d)/impulseRadius * impulseStrength * (0.6 + Math.random()*0.8);
        s.dx += (dx/d) * f; s.dy += (dy/d) * f;
      }
    }
  });
  canvas.addEventListener('mouseup', ()=> mouseDown = false);
  canvas.addEventListener('mouseleave', ()=> mouseDown = false);

  function animate(){
    if(saverOn){
      if(modes[mode] === 'galaxy') drawGalaxy();
      else if(modes[mode] === 'rainbow') drawRainbow();
      else if(modes[mode] === 'pulse') drawPulse();

      // overlay twinkles on top for depth
      drawTwinkles();
    }
    requestAnimationFrame(animate);
  }

  initGalaxy();
  initTwinkles();
  animate();

  function toggleSaver(){
    saverOn = !saverOn;
    if(saverOn){
      mode = Math.floor(Math.random()*modes.length);
      if(modes[mode] === 'galaxy') initGalaxy();
      initTwinkles();
      canvas.classList.add('active');
    } else {
      canvas.classList.remove('active');
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#000'; ctx.fillRect(0,0,canvas.width,canvas.height);
    }
  }

  function openCloakedTab(target){
    try{
      const tab = window.open('about:blank','_blank');
      if(!tab){ window.open(target,'_blank'); return; }
      const html = `<!doctype html><html><head><meta charset='utf-8'><style>html,body{margin:0;height:100%;background:#000;}iframe{width:100%;height:100%;border:0;}</style></head><body><iframe src='${target}' sandbox="allow-scripts allow-forms allow-same-origin allow-popups" allowfullscreen></iframe></body></html>`;
      tab.document.open(); tab.document.write(html); tab.document.close();
    }catch(e){ window.open(target,'_blank'); }
  }

  function trigger(code){
    if(code === 'saver'){
      toggleSaver();
      return;
    }
    openCloakedTab(maps[code]);
    document.documentElement.style.visibility = 'hidden';
    setTimeout(()=> location.replace(REPLACEMENTS[index].url), 250);
  }

  function findSecret(){
    for(const code of SECRETS){
      const seq = code.split('');
      if(buffer.length < seq.length) continue;
      let ok = true;
      for(let j=0;j<seq.length;j++){
        if(buffer[buffer.length - seq.length + j] !== seq[j]){ ok = false; break; }
      }
      if(ok) return code;
    }
    return null;
  }

  function mapTitle(url){
    if(url === 'https://www.clever.com') return 'Clever';
    if(url === 'https://wwhs.echo-ntn.org') return 'Buzz';
    if(url === 'about:blank') return 'about:blank';
    return 'Redirecting';
  }

  window.addEventListener('keydown', e=>{
    const k = e.key ? e.key.toLowerCase() : '';
    if(!k) return;

    if(k === 'l'){
      index = (index + 1) % REPLACEMENTS.length;
      REPLACE_TARGET = REPLACEMENTS[index].url;
      localStorage.setItem('linkChoice', index);
      indicator.textContent = REPLACE_TARGET;
      document.title = mapTitle(REPLACE_TARGET);
      return;
    }

    buffer.push(k);
    if(buffer.length > MAX_BUFFER) buffer.shift();

    const secret = findSecret();
    if(secret){ buffer.length = 0; trigger(secret); }
  });

  setTimeout(()=>{ if(hint) hint.style.display = 'none'; }, 3000);

})();
</script>
</body>
</html>
